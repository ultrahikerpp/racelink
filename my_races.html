<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„è³½äº‹ - RaceLink Taiwan</title>
    <!-- Tailwind CSS (for Daily Quotes widget compatibility) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Russo+One&family=Space+Grotesk:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+TC:wght@400;700;900&display=swap"
        rel="stylesheet">
    <style>
        /* Shared Styles & Overrides */
        body {
            /* Ensure font consistency especially with Tailwind loaded */
            font-family: 'Space Grotesk', 'Noto Sans TC', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-primary);
            /* Fallback/Base */
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        @media (min-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Race Selector Scrollbar */
        .race-selector {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding: 1rem 0;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-neon) var(--surface-dark);
        }

        .race-chip {
            background: var(--surface-dark);
            border: 1px solid var(--border-light);
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-full);
            color: var(--text-sccondary);
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .race-chip:hover {
            border-color: var(--primary-neon);
            color: var(--text-primary);
        }

        .race-chip.active {
            background: var(--primary-neon);
            color: #000;
            border-color: var(--primary-neon);
            font-weight: bold;
            box-shadow: 0 0 15px rgba(204, 255, 0, 0.4);
        }

        /* Module Containers */
        .module-card {
            background: var(--surface-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .module-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .module-title {
            font-family: 'Russo One', sans-serif;
            font-size: 1.5rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .module-content {
            padding: 1.5rem;
            flex-grow: 1;
        }

        /* Weather Specifics (Adapted from weather.html) */
        .weather-hero {
            background: linear-gradient(135deg, rgba(255, 72, 0, 0.1) 0%, rgba(5, 10, 24, 0.8) 100%);
            border: 1px solid var(--primary-neon);
            color: white;
            padding: 2rem;
            border-radius: var(--radius-md);
            text-align: center;
            margin-bottom: 1.5rem;
            transition: all 0.3s;
        }

        /* Light Mode Override for Weather Hero */
        [data-theme="light"] .weather-hero {
            background: linear-gradient(135deg, #e0f2fe 0%, #ffffff 100%);
            /* Sky blue to white */
            border-color: var(--accent-cyan);
            color: var(--text-primary);
            box-shadow: 0 4px 15px rgba(8, 145, 178, 0.1);
        }

        [data-theme="light"] .weather-hero .text-slate-300 {
            color: var(--text-sccondary);
            /* Fix location text */
        }

        [data-theme="light"] .weather-hero .temp-display {
            color: var(--text-primary);
            text-shadow: none;
        }

        [data-theme="light"] .weather-hero .text-xl {
            color: var(--accent-cyan);
        }

        [data-theme="light"] .weather-hero span.rounded-full {
            background: rgba(255, 255, 255, 0.5);
            border-color: var(--border-light);
            color: var(--text-primary);
            font-weight: 600;
        }

        .temp-display {
            font-size: 4rem;
            font-weight: 800;
            font-family: 'Russo One', sans-serif;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
            margin: 0.5rem 0;
            line-height: 1;
        }

        .forecast-row {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .forecast-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: var(--radius-sm);
            min-width: 80px;
            text-align: center;
        }

        [data-theme="light"] .forecast-item {
            background: rgba(0, 0, 0, 0.03);
            border: 1px solid var(--border-light);
        }

        [data-theme="light"] .forecast-item .text-slate-400 {
            color: var(--text-sccondary);
        }

        [data-theme="light"] .forecast-item .font-bold {
            color: var(--text-primary);
        }

        /* Outfit Box Styles */
        .outfit-box {
            background: rgba(30, 41, 59, 0.5);
            /* dark slate */
            padding: 1rem;
            border-radius: var(--radius-md);
            border-left: 4px solid #facc15;
            /* yellow-400 */
            color: #cbd5e1;
            /* slate-300 */
            font-size: 0.875rem;
            line-height: 1.625;
            transition: all 0.3s;
        }

        [data-theme="light"] .outfit-box {
            background: #f0f9ff;
            /* sky-50 */
            border-left-color: var(--primary-neon);
            /* Use primary orange for contrast or keep yellow? User said "too dark", so lighter is key */
            color: var(--text-primary);
        }

        [data-theme="light"] .outfit-box strong {
            color: var(--accent-cyan);
        }


        /* Logistics Specifics (Adapted from logistics.html) */
        .map-preview {
            position: relative;
            height: 300px;
            background: #1a2236;
            border-radius: var(--radius-md);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 1.5rem;
        }

        .logistics-list {
            display: grid;
            gap: 1rem;
        }

        .logistics-item {
            background: rgba(255, 255, 255, 0.03);
            padding: 1rem;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.2s;
        }

        .logistics-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        /* Daily Quotes Widget (Tailwind overrides/integration) */


        /* Traffic Alert Styles */
        .traffic-alert {
            margin-top: 1.5rem;
            padding: 1rem;
            background: rgba(124, 45, 18, 0.2);
            /* orange-900/20 */
            border-left: 4px solid #f97316;
            /* orange-500 */
            border-radius: 0 0.25rem 0.25rem 0;
            font-size: 0.875rem;
            transition: all 0.3s;
        }

        .alert-content {
            color: #cbd5e1;
            /* slate-300 */
        }

        [data-theme="light"] .traffic-alert {
            background: #fff7ed;
            /* orange-50 */
            border-color: #f97316;
        }

        [data-theme="light"] .alert-content {
            color: #9a3412;
            /* orange-800 - High Contrast */
        }

        /* Modal Animation (from DailySurprise) */
        .modal-enter {
            animation: modalPop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes modalPop {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }

            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Review Module Styles */
        .rating-box {
            margin-bottom: 1.5rem;
            text-align: center;
            padding: 1rem;
            background: rgba(30, 41, 59, 0.5);
            /* slate-800/50 */
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
        }

        [data-theme="light"] .rating-box {
            background: #f8fafc;
            /* slate-50 */
            border-color: var(--border-light);
        }

        .rating-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 700;
            color: var(--text-sccondary);
            /* slate-400 equivalent */
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        [data-theme="light"] .rating-label {
            color: var(--text-sccondary);
            /* Ensure visibility in light mode */
        }

        .rating-category {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        [data-theme="light"] .rating-category {
            border-bottom-color: rgba(0, 0, 0, 0.05);
        }

        .rating-category:last-child {
            border-bottom: none;
        }

        .stars {
            display: flex;
            gap: 0.25rem;
            cursor: pointer;
        }

        .star {
            font-size: 1.25rem;
            color: var(--text-sccondary);
            transition: color 0.2s;
        }

        /* Hover effect for better interactivity */
        .vote-btn:hover {
            transform: translateY(-2px);
        }

        /* JS driven active state */
        .star.filled {
            color: #fbbf24;
            /* amber-400 */
        }

        .review-input {
            width: 100%;
            background: var(--surface-dark);
            /* Match input bg to theme */
            border: 1px solid var(--border-light);
            border-radius: var(--radius-sm);
            padding: 1rem;
            color: var(--text-primary);
            font-family: inherit;
            resize: vertical;
            min-height: 120px;
            margin-bottom: 1rem;
            transition: all 0.3s;
        }

        [data-theme="light"] .review-input {
            background: #ffffff;
            border-color: #cbd5e1;
            /* slate-300 */
        }

        .review-input:focus {
            outline: none;
            border-color: var(--primary-neon);
            box-shadow: 0 0 0 2px rgba(var(--primary-neon-rgb), 0.2);
        }
    </style>
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar" style="position: relative; z-index: 50;">
        <div class="container flex-between">
            <a href="index.html" class="nav-logo">
                <img src="images/logo.png" alt="RaceLink TW">
            </a>
            <ul class="nav-links">
                <li><a href="index.html">é¦–é </a></li>
                <li><a href="race_list.html">è³½äº‹è¡Œäº‹æ›†</a></li>
                <li><a href="my_races.html" class="active">æˆ‘çš„è³½äº‹</a></li>
                <li><a href="dashboard.html">å€‹äººå„€è¡¨æ¿</a></li>
            </ul>
            <div style="display: flex; align-items: center; gap: 1rem;">
                <button class="theme-toggle-btn" aria-label="Toggle Dark Mode" onclick="toggleTheme()">ğŸŒ™</button>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span style="font-size: 0.9rem; color: var(--text-primary);">Miro</span>
                    <div
                        style="width: 32px; height: 32px; background: var(--accent-volt); border-radius: 50%; box-shadow: 0 0 10px var(--accent-volt);">
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container py-8 relative" style="padding-top: 2rem;">

        <!-- Header & Daily Quote -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-6">
            <div>
                <h1 class="text-4xl font-bold font-russo mb-2" style="color: var(--text-primary);">æˆ‘çš„è³½äº‹</h1>
                <p style="color: var(--text-sccondary);">ç®¡ç†é€™å­£çš„é‡é»ç›®æ¨™ï¼ŒæŒæ¡å¤©æ°£èˆ‡è³½é“è³‡è¨Šã€‚</p>
            </div>

            <!-- Daily Quote Widget -->
            <div class="relative group cursor-pointer" onclick="openQuoteModal()">
                <div
                    class="absolute -inset-1 bg-gradient-to-r from-pink-600 to-purple-600 rounded-xl blur opacity-75 group-hover:opacity-100 transition duration-1000 group-hover:duration-200">
                </div>
                <div class="relative rounded-lg px-6 py-3 border border-slate-700 flex items-center gap-4 transition"
                    style="background: var(--surface-card); border-color: var(--border-light);">
                    <div class="text-3xl">ğŸ</div>
                    <div>
                        <div class="text-pink-400 font-bold text-sm uppercase tracking-wider">Daily Quote</div>
                        <div class="font-bold" style="color: var(--text-primary);">æ¯æ—¥èªéŒ„</div>
                    </div>
                    <div class="text-xs ml-2" style="color: var(--text-sccondary);">é»æ“Šé–‹å•Ÿ</div>
                </div>
            </div>
        </div>

        <!-- Race Selector -->
        <div class="mb-8">
            <h3 class="text-sm uppercase tracking-widest font-bold mb-3" style="color: var(--text-sccondary);">é¸æ“‡è³½äº‹</h3>
            <div class="race-selector" id="race-selector">
                <!-- Chips injected by JS -->
                <div class="italic px-4" style="color: var(--text-sccondary);">è¼‰å…¥å·²å ±åè³½äº‹...</div>
            </div>
        </div>

        <!-- Main Dashboard Grid -->
        <div class="dashboard-grid" id="race-dashboard" style="display: none;">

            <!-- Weather Module -->
            <div class="module-card animate-fade-up">
                <div class="module-header">
                    <div class="module-title">
                        <span>ğŸŒ¦ï¸</span> å¤©æ°£åŠ©æ‰‹
                    </div>
                    <span class="text-xs bg-slate-800 px-2 py-1 rounded text-cyan-400 border border-cyan-400/30">LIVE
                        Forecast</span>
                </div>
                <div class="module-content">
                    <div class="weather-hero">
                        <div class="text-slate-300 text-sm tracking-widest uppercase mb-2" id="weather-loc">ğŸ“ å°åŒ—å¸‚ |
                            ç¸½çµ±åºœå»£å ´</div>
                        <div class="temp-display" id="weather-temp">16Â°C</div>
                        <div class="text-xl text-cyan-300" id="weather-desc">å¤šé›²æ™‚é™° Cloudy</div>
                        <div class="flex justify-center gap-4 mt-4 text-sm">
                            <span class="bg-black/30 px-3 py-1 rounded-full border border-white/10">ğŸ’§ 75%</span>
                            <span class="bg-black/30 px-3 py-1 rounded-full border border-white/10">ğŸŒ¬ï¸ 3.5 m/s</span>
                        </div>
                    </div>

                    <div class="mb-6">
                        <h4 class="font-bold text-white mb-3 text-lg flex items-center gap-2">
                            <span>ğŸ‘•</span> ç©¿æ­å»ºè­°
                        </h4>
                        <div class="outfit-box">
                            <p id="outfit-text">é«”æ„Ÿåæ¶¼ï¼Œå»ºè­°ç©¿è‘— <strong>é€æ°£é•·è¢–å£“ç¸®è¡£</strong> æ­é…
                                <strong>è·‘æ­¥èƒŒå¿ƒ</strong>ã€‚èµ·è·‘å‰å¯æº–å‚™æ‹‹æ£„å¼é›¨è¡£ä¿æš–ã€‚
                            </p>
                        </div>
                    </div>

                    <div>
                        <h4 class="font-bold text-white mb-3 text-sm uppercase tracking-wider">è³½äº‹æ™‚æ®µé å ±</h4>
                        <div class="forecast-row">
                            <div class="forecast-item">
                                <div class="text-xs text-slate-400">06:00</div>
                                <div class="text-2xl my-1">â˜ï¸</div>
                                <div class="font-bold">15Â°C</div>
                            </div>
                            <div class="forecast-item">
                                <div class="text-xs text-slate-400">08:00</div>
                                <div class="text-2xl my-1">â›…</div>
                                <div class="font-bold">17Â°C</div>
                            </div>
                            <div class="forecast-item">
                                <div class="text-xs text-slate-400">10:00</div>
                                <div class="text-2xl my-1">â˜€ï¸</div>
                                <div class="font-bold">20Â°C</div>
                            </div>
                            <div class="forecast-item">
                                <div class="text-xs text-slate-400">12:00</div>
                                <div class="text-2xl my-1">â˜€ï¸</div>
                                <div class="font-bold">22Â°C</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Logistics Module -->
            <div class="module-card animate-fade-up delay-100">
                <div class="module-header">
                    <div class="module-title">
                        <span>ğŸ—ºï¸</span> è³½äº‹åœ°åœ–
                    </div>
                    <button
                        class="text-xs bg-primary-neon text-black px-3 py-1 rounded font-bold hover:bg-white transition">å…¨è¢å¹•åœ°åœ–</button>
                </div>
                <div class="module-content">
                    <div class="map-preview">
                        <img src="images/map_dark.png" alt="Race Map"
                            style="width: 100%; height: 100%; object-fit: cover;">
                        <div
                            class="absolute bottom-4 left-4 bg-slate-900/90 backdrop-blur px-3 py-1 rounded border border-primary-neon/50">
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                <span class="text-xs font-bold text-green-400">GPS Active</span>
                            </div>
                        </div>
                    </div>

                    <div class="logistics-list">
                        <div class="logistics-item group cursor-pointer hover:border hover:border-primary-neon/30">
                            <div class="text-2xl bg-slate-800 p-3 rounded-full">ğŸ’</div>
                            <div class="flex-grow">
                                <h4 class="font-bold text-white group-hover:text-primary-neon transition">è¡£ç‰©ä¿ç®¡å€</h4>
                                <p class="text-xs text-slate-400">A-Eå€ï¼Œé–‹æ”¾æ™‚é–“ 04:00 - 12:00</p>
                            </div>
                            <div class="text-xl text-slate-600 group-hover:text-white">â€º</div>
                        </div>
                        <div class="logistics-item group cursor-pointer hover:border hover:border-primary-neon/30">
                            <div class="text-2xl bg-slate-800 p-3 rounded-full">ğŸš»</div>
                            <div class="flex-grow">
                                <h4 class="font-bold text-white group-hover:text-primary-neon transition">æµå‹•å»æ‰€</h4>
                                <p class="text-xs text-slate-400">èµ·è·‘é»å¾Œæ–¹ 50mï¼Œæ’éšŠäººæ½®è¼ƒå°‘</p>
                            </div>
                            <div class="text-xl text-slate-600 group-hover:text-white">â€º</div>
                        </div>
                        <div class="logistics-item group cursor-pointer hover:border hover:border-primary-neon/30">
                            <div class="text-2xl bg-slate-800 p-3 rounded-full">ğŸšŒ</div>
                            <div class="flex-grow">
                                <h4 class="font-bold text-white group-hover:text-primary-neon transition">æ¥é§è»Šç«™</h4>
                                <p class="text-xs text-slate-400">æ·é‹ç«™ 2 è™Ÿå‡ºå£ï¼Œ04:30 é¦–ç™¼</p>
                            </div>
                            <div class="text-xl text-slate-600 group-hover:text-white">â€º</div>
                        </div>
                    </div>

                    <div class="traffic-alert">
                        <strong class="text-orange-400 block mb-1">âš ï¸ äº¤é€šç®¡åˆ¶æé†’</strong>
                        <span class="alert-content">è³½é“å‘¨é‚Šé“è·¯å°‡æ–¼ 04:00 èµ·é€²è¡Œå…¨ç·šå°é–‰ï¼Œè«‹é€šçŸ¥è¦ªå‹ææ—©æ”¹é“ã€‚</span>
                    </div>
                </div>
            </div>

            <!-- Review Module -->
            <div class="module-card animate-fade-up delay-200" style="grid-column: 1 / -1;">
                <div class="module-header">
                    <div class="module-title">
                        <span>ğŸ“</span> è³½äº‹è©•åƒ¹
                    </div>
                </div>
                <div class="module-content">
                    <form id="review-form" onsubmit="submitReview(event)">

                        <!-- Overall Rating -->
                        <div class="rating-box">
                            <label class="rating-label">æ•´é«”è©•åƒ¹</label>
                            <div class="flex justify-center gap-2 stars" id="rating-overall">
                                <button type="button" class="star text-3xl focus:outline-none"
                                    onclick="rate('overall', 1)">â˜…</button>
                                <button type="button" class="star text-3xl focus:outline-none"
                                    onclick="rate('overall', 2)">â˜…</button>
                                <button type="button" class="star text-3xl focus:outline-none"
                                    onclick="rate('overall', 3)">â˜…</button>
                                <button type="button" class="star text-3xl focus:outline-none"
                                    onclick="rate('overall', 4)">â˜…</button>
                                <button type="button" class="star text-3xl focus:outline-none"
                                    onclick="rate('overall', 5)">â˜…</button>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-2 mb-6">
                            <!-- Categories -->
                            <div class="rating-category">
                                <span class="text-sm font-medium">è³½é“è·¯æ³</span>
                                <div class="stars" id="rating-track">
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('track', 1)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('track', 2)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('track', 3)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('track', 4)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('track', 5)">â˜…</button>
                                </div>
                            </div>
                            <div class="rating-category">
                                <span class="text-sm font-medium">è³½é“è£œçµ¦</span>
                                <div class="stars" id="rating-supply">
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('supply', 1)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('supply', 2)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('supply', 3)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('supply', 4)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('supply', 5)">â˜…</button>
                                </div>
                            </div>
                            <div class="rating-category">
                                <span class="text-sm font-medium">å¤§æœƒå®‰æ’</span>
                                <div class="stars" id="rating-org">
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('org', 1)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('org', 2)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('org', 3)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('org', 4)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('org', 5)">â˜…</button>
                                </div>
                            </div>
                            <div class="rating-category">
                                <span class="text-sm font-medium">åƒè³½ç‰©è³‡</span>
                                <div class="stars" id="rating-kit">
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('kit', 1)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('kit', 2)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('kit', 3)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('kit', 4)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('kit', 5)">â˜…</button>
                                </div>
                            </div>
                            <div class="rating-category">
                                <span class="text-sm font-medium">å®Œè³½ç¦®</span>
                                <div class="stars" id="rating-gift">
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('gift', 1)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('gift', 2)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('gift', 3)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('gift', 4)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('gift', 5)">â˜…</button>
                                </div>
                            </div>
                            <div class="rating-category">
                                <span class="text-sm font-medium">çç‰Œè¨­è¨ˆ</span>
                                <div class="stars" id="rating-medal">
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('medal', 1)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('medal', 2)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('medal', 3)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('medal', 4)">â˜…</button>
                                    <button type="button" class="star focus:outline-none"
                                        onclick="rate('medal', 5)">â˜…</button>
                                </div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label for="review-text" class="rating-label">è³½äº‹è©•è«–</label>
                            <textarea id="review-text" class="review-input" placeholder="åˆ†äº«æ‚¨çš„åƒè³½å¿ƒå¾—..."></textarea>
                        </div>

                        <div class="text-right">
                            <button type="submit"
                                class="bg-primary-neon text-black font-bold py-2 px-6 rounded hover:bg-white transition shadow-lg shadow-lime-500/20">é€å‡ºè©•åƒ¹</button>
                        </div>
                    </form>
                </div>
            </div>

        </div>

        <!-- Empty State -->
        <div id="empty-state" class="text-center py-20 hidden">
            <div class="text-6xl mb-4 opacity-30">ğŸƒâ€â™‚ï¸</div>
            <h3 class="text-2xl font-bold text-white mb-2">å°šæœªå ±åä»»ä½•è³½äº‹</h3>
            <p class="text-slate-400 mb-8">å‰å¾€è³½äº‹åˆ—è¡¨å°‹æ‰¾æ‚¨çš„ä¸‹ä¸€å€‹æŒ‘æˆ°å§ï¼</p>
            <a href="race_list.html"
                class="bg-primary-neon text-black font-bold py-3 px-8 rounded-full hover:bg-white transition">å‰å¾€è³½äº‹åˆ—è¡¨</a>
        </div>

    </main>

    <!-- Daily Quote Modal -->
    <div id="quote-modal"
        class="fixed inset-0 z-[100] flex items-center justify-center pointer-events-none opacity-0 transition-opacity duration-300">
        <div class="absolute inset-0 bg-slate-950/90 backdrop-blur-sm" onclick="closeQuoteModal()"></div>
        <div id="quote-box"
            class="relative bg-slate-900 border-2 border-pink-500/50 rounded-2xl p-8 max-w-sm w-full mx-4 shadow-2xl transform scale-90 transition-transform">
            <button onclick="closeQuoteModal()" class="absolute top-4 right-4 text-slate-500 hover:text-white">
                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <div class="text-center pt-2">
                <div class="inline-block p-3 rounded-full bg-pink-500/20 mb-4">
                    <span class="text-4xl">ğŸ’¡</span>
                </div>
                <h3 class="text-2xl font-black text-white mb-6">æ¯æ—¥è·‘è€…èªéŒ„</h3>
                <div
                    class="bg-slate-800/50 rounded-xl p-6 border border-slate-700 mb-6 min-h-[120px] flex items-center justify-center">
                    <p id="quote-text" class="text-lg text-slate-200 font-medium leading-relaxed">Loading...</p>
                </div>
                <button onclick="closeQuoteModal()"
                    class="w-full bg-pink-600 hover:bg-pink-500 text-white font-bold py-3 rounded-xl transition shadow-lg shadow-pink-600/20">æ”¶ä¸‹èƒ½é‡</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/main.js"></script>
    <script src="js/race_data.js"></script>
    <script>
        // 1. Load Registered Races
        document.addEventListener('DOMContentLoaded', () => {
            const registeredNames = JSON.parse(localStorage.getItem('registeredRaces') || '[]');
            const selector = document.getElementById('race-selector');
            const dashboard = document.getElementById('race-dashboard');
            const emptyState = document.getElementById('empty-state');

            // Filter global raceEvents for registered ones
            // Ensure window.raceEvents is loaded (from js/race_data.js)
            const allEvents = window.raceEvents || [];
            const myRaces = allEvents.filter(e => registeredNames.includes(e.name));

            if (myRaces.length === 0) {
                selector.style.display = 'none';
                dashboard.style.display = 'none';
                emptyState.classList.remove('hidden');
                return;
            }

            // Render Selector Chips
            selector.innerHTML = '';
            dashboard.style.display = 'grid'; // Show dashboard

            myRaces.forEach((race, index) => {
                const chip = document.createElement('div');
                chip.className = `race-chip ${index === 0 ? 'active' : ''}`; // Select first by default
                chip.innerHTML = `<span>ğŸ…</span> ${race.name}`;
                chip.onclick = () => selectRace(race, chip);
                selector.appendChild(chip);
            });

            // Initial Render of first race
            if (myRaces.length > 0) {
                updateDashboard(myRaces[0]);
            }
        });

        // 2. Select Race Logic
        function selectRace(race, chipElement) {
            // Update UI Active State
            document.querySelectorAll('.race-chip').forEach(c => c.classList.remove('active'));
            chipElement.classList.add('active');

            updateDashboard(race);
        }

        // 3. Update Dashboard Content (Mock Data Logic)
        function updateDashboard(race) {
            // Update Weather Loc
            // Extract City from location (simple heuristic)
            const location = race.location || 'æœªçŸ¥åœ°é»';
            const city = location.substring(0, 3);
            document.getElementById('weather-loc').textContent = `ğŸ“ ${city} | ${location}`;

            // Mock Random Weather Variations for demo purpose
            // In a real app, this would fetch API data based on race.date and race.location
            const temps = [14, 16, 18, 22, 12];
            const baseTemp = temps[Math.floor(Math.random() * temps.length)];

            document.getElementById('weather-temp').textContent = `${baseTemp}Â°C`;

            // Adjust desc based on temp
            if (baseTemp < 15) {
                document.getElementById('weather-desc').textContent = "é™°æœ‰é›¨ Rainy";
                document.getElementById('outfit-text').innerHTML = `æ°£æº«åä½ä¸”æœ‰é›¨ï¼Œå»ºè­°ç©¿è‘— <strong>é˜²æ°´é¢¨è¡£</strong> èˆ‡ <strong>ä¿æš–é•·è¤²</strong>ã€‚å‹™å¿…æº–å‚™æ›¿æ›è¡£ç‰©ä»¥å…å¤±æº«ã€‚`;
            } else if (baseTemp > 24) {
                document.getElementById('weather-desc').textContent = "æ™´æœ—ç‚ç†± Sunny";
                document.getElementById('outfit-text').innerHTML = `å¤©æ°£ç‚ç†±ï¼Œè«‹é¸æ“‡ <strong>æ¥µè¼•é‡é€æ°£èƒŒå¿ƒ</strong>ã€‚æ³¨æ„ <strong>æ°´åˆ†è£œå……</strong> èˆ‡ <strong>é˜²æ›¬</strong>ã€‚`;
            } else {
                document.getElementById('weather-desc').textContent = "å¤šé›²æ™‚é™° Cloudy";
                document.getElementById('outfit-text').innerHTML = `é«”æ„Ÿèˆ’é©ï¼Œå»ºè­°ç©¿è‘— <strong>é€æ°£çŸ­è¢–</strong> æˆ– <strong>èƒŒå¿ƒ</strong>ã€‚èµ·è·‘å‰å¯ç©¿è‘—è–„å¤–å¥—ç†±èº«ã€‚`;
            }
        }

        // 4. Daily Quote Logic
        const quotes = [
            "è·‘æ­¥ä¸æ˜¯ç‚ºäº†æˆ°å‹åˆ¥äººï¼Œè€Œæ˜¯ç‚ºäº†æˆ°å‹æ˜¨å¤©çš„è‡ªå·±ã€‚",
            "ç—›æ˜¯é›£å…çš„ï¼Œè‹¦æ˜¯ç”˜é¡˜çš„ã€‚ (Pain is inevitable. Suffering is optional.)",
            "åªè¦å‡ºç™¼ï¼Œå°±èƒ½æŠµé”ã€‚",
            "æ²’æœ‰å¥‡è¹Ÿï¼Œåªæœ‰ç´¯ç©ã€‚",
            "ä½ çš„é›™è…³ï¼Œå¸¶ä½ å»ä½ æƒ³å»çš„åœ°æ–¹ã€‚"
        ];

        const modal = document.getElementById('quote-modal');
        const quoteBox = document.getElementById('quote-box');
        const quoteText = document.getElementById('quote-text');

        function openQuoteModal() {
            const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
            quoteText.textContent = randomQuote;

            modal.classList.remove('opacity-0', 'pointer-events-none');
            modal.classList.add('opacity-100', 'pointer-events-auto');
            quoteBox.classList.add('modal-enter');
        }

        function closeQuoteModal() {
            modal.classList.remove('opacity-100', 'pointer-events-auto');
            modal.classList.add('opacity-0', 'pointer-events-none');
            quoteBox.classList.remove('modal-enter');
        }

        // 5. Review System Logic
        const ratings = {
            overall: 0,
            track: 0,
            supply: 0,
            org: 0,
            kit: 0,
            gift: 0,
            medal: 0
        };

        function rate(category, value) {
            ratings[category] = value;
            updateStarDisplay(category);
        }

        function updateStarDisplay(category) {
            const container = document.getElementById(`rating-${category}`);
            const stars = container.querySelectorAll('.star');

            stars.forEach((star, index) => {
                if (index < ratings[category]) {
                    star.classList.add('filled');
                } else {
                    star.classList.remove('filled');
                }
            });
        }

        function submitReview(event) {
            event.preventDefault();

            // Check if overall rating is set
            if (ratings.overall === 0) {
                alert('è«‹è‡³å°‘çµ¦äºˆæ•´é«”è©•åƒ¹ï¼');
                return;
            }

            const comment = document.getElementById('review-text').value;
            const activeRace = document.querySelector('.race-chip.active').textContent.replace('ğŸ… ', '').trim();

            // In a real app, send to backend
            console.log(`Submitting review for ${activeRace}:`, { ratings, comment });

            alert(`æ„Ÿè¬æ‚¨ï¼å·²æˆåŠŸé€å‡ºå°ã€Œ${activeRace}ã€çš„è©•åƒ¹ã€‚`);

            // Reset form
            resetReviewForm();
        }

        function resetReviewForm() {
            Object.keys(ratings).forEach(key => {
                ratings[key] = 0;
                updateStarDisplay(key);
            });
            document.getElementById('review-text').value = '';
        }

        // Add to updateDashboard to clear form when switching races
        const originalUpdateDashboard = updateDashboard;
        updateDashboard = function (race) {
            originalUpdateDashboard(race);
            resetReviewForm();
            // Optional: Load previous review if exists
        };
    </script>
</body>

</html>